# 交易系统规范

> 本规范定义了回测系统和实盘系统的标准流程，确保两者完全一致。

## 1. 开盘前流程

### 1.1 获取活跃股票列表
- 条件：60天日均成交额 >= 3000万

### 1.2 基本面筛选
- PE < 25
- ROE > 10%
- 股息率 > 1%
- 负债率 < 70%
- 市值 > 30亿

### 1.3 识别市场环境
- 市场类型：牛市 / 熊市 / 震荡市
- **每天开盘前都要检测**，不是每10天检测一次

#### 1.3.1 环境变化处理
- 如果环境变化了，卖出不适用新环境的策略所持有的股票
- 如果环境不变，则没有特殊处理

### 1.4 检查持仓
- **满仓定义**：持仓市值超过总资金的90%

#### 1.4.1 满仓时
- 不进行任何买入操作

#### 1.4.2 未满仓时
继续以下步骤：

##### 1.4.2.1 选择交易策略
- 根据当前市场环境，选择1个**最擅长**当前市场环境的交易策略
- 具体选择哪个策略，根据回测系统中的交易策略表现来确定

##### 1.4.2.2 计算信号分数
- 使用所选策略的技术评分公式
- 对步骤1.2筛选出的股票计算信号分数
- 按分数排序

##### 1.4.2.3 买入
- 计算未持仓比例：每有总资金10%的未持仓，就买入1只
- 从排序后的股票列表中，选择信号分数最高的股票买入

---

## 2. 开盘时流程

### 2.1 实盘系统（tick数据）

#### 2.1.1 卖出标准
- 如果满足卖出标准，就卖出该股票
- 如果不满足卖出标准，就不进行任何操作
- **T+1限制**：A股只能在买入的第二天或之后才能卖出

#### 2.1.2 加仓标准
- 如果满足加仓标准
- 根据加仓逻辑计算出需要购买的股票数量
- 然后购买

### 2.2 回测系统（日线数据）

#### 2.2.1 卖出标准
- 检查当日最高价或最低价是否满足交易策略的卖出标准
- 如果满足，就卖出该股票
- 如果不满足，就不进行任何操作
- **T+1限制**：A股只能在买入的第二天或之后才能卖出

#### 2.2.2 加仓标准
- 如果满足加仓标准
- 根据加仓逻辑计算出需要购买的股票数量
- 然后购买

---

## 3. 策略分组

### 牛市（14个策略）
成交量突破、MACD+成交量、MACD策略、突破前高、均线发散、量价齐升、RSI趋势、趋势过滤、均线策略、均线交叉强度、收盘站均线、成交量+均线、突破确认、平台突破

### 熊市（6个策略）
动量反转、威廉指标、RSI逆势、双底形态、缩量回调、MACD背离

### 震荡市（6个策略）
布林带、RSI+均线、布林带+RSI、支撑阻力、波动率突破、均线收复

---

## 4. 交易参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 止盈 | 20% | 达到20%收益自动卖出 |
| 止损 | 10% | 亏损10%自动卖出 |
| 信号阈值 | 40分 | 低于40分不买入 |
| 最大持仓 | 10只 | 最多同时持有10只 |
| 单只仓位 | 10% | 每只股票10%仓位 |

---

## 5. 关键原则

1. **一致性**：回测系统必须与实盘系统流程完全一致
2. **T+1**：A股只能在买入后第二天才能卖出
3. **每天检测**：市场环境每天开盘前检测
4. **单一策略**：每次只选择1个最优策略，不是多个
5. **满仓不买**：持仓>90%时不再买入
